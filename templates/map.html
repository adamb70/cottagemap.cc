<!DOCTYPE html>
<html style="width: 100%; height: 100%;" lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript">
		const regions = JSON.parse({{ regions|tojson }});
    </script>

    <script src='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet'/>


    <title>Map</title>


    <style>
        .marker {
            background-image: url('{{ url_for('static', filename='map-icon.png') }}');
            background-size: cover;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        .mapboxgl-popup {
            max-width: 300px !important;
        }

        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
        }

        .mapboxgl-popup-close-button {
            font-size: 20px;
        }
    </style>


</head>
<body style="width: 100%; height: 100%; margin: 0;">


<div id='map' style='width: 100%; height: 100%;'></div>
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoiYWJsaW5kbWFuIiwiYSI6ImNqcmY1ZDd6cDBydWQ0M3A4OHJ4b2czZGwifQ.brwgWx9jn2ut0PAOqEookQ';
	const map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/light-v10',
		{#style: 'mapbox://styles/mapbox/cj4k8wmwy5lbt2smsigkbh18e',#}
		{#style: 'mapbox://styles/mapbox/cjvshts5l1et01coz11pa6jam',#}
		center: [-3.953423, 54.312727],
		zoom: 5,
	});

	// init markers
	for (let region in regions) {
		for (let cottage of regions[region]) {

			// create a HTML element for each feature
			let el = document.createElement('div');
			el.className = 'marker';


			new mapboxgl.Marker(el)
				.setLngLat([cottage.lon, cottage.lat])
				.setPopup(new mapboxgl.Popup({offset: 25}) // add popups
					.setHTML('<h3>' + cottage.title + '</h3><p>' + cottage.description + '</p>'))
				.addTo(map);

		}
	}

</script>


</body>
</html>